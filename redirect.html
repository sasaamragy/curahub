
  <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <!-- ÿ™ÿ≠ŸÖŸäŸÑ ŸÖŸÉÿ™ÿ®ÿ© FHIR -->
  <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.min.js"></script>
</head>
<body>
  <p>‚è≥ Redirecting... Please wait...</p>

  <script>
    window.onload = function () {
      try {
        console.log("üåê Starting OAuth2 redirect handling...");
        FHIR.oauth2.ready()
          .then(client => {
            console.log("‚úÖ FHIR Client Ready");
            console.log("Patient ID:", client.patient.id);
            console.log("Access Token:", client.state.tokenResponse.access_token);

            const patientId = client.patient.id;
            const accessToken = client.state.tokenResponse.access_token;

            // ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿ™ÿÆÿ≤ŸäŸÜ ÿßŸÑŸÖÿ§ŸÇÿ™
            sessionStorage.setItem("patient_id", patientId);
            sessionStorage.setItem("access_token", accessToken);

            // ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑÿµŸÅÿ≠ÿ© ÿπÿ±ÿ∂ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±Ÿäÿ∂
            window.location.href = "patient-data.html";
          })
          .catch(error => {
            console.error("‚ùå OAuth2 redirect error (inside .catch):", error);
            document.body.innerHTML = `
              <h3 style="color: red;">‚ùå Error during OAuth2 redirect:</h3>
              <pre>${JSON.stringify(error, null, 2)}</pre>
            `;
          });
      } catch (e) {
        console.error("‚ùå Error during script execution (outside catch):", e);
        document.body.innerHTML = `
          <h3 style="color: red;">‚ùå Fatal error in redirect.html</h3>
          <pre>${JSON.stringify(e, null, 2)}</pre>
        `;
      }
    };
  </script>
</body>
</html>
